{% extends "base.html" %}

{% block title %}Resumes - Candidate Insights{% endblock %}

{% block extra_css %}
<style>
    /* ... (same CSS as before) ... */
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0;
        padding: 1.5rem;
        background: linear-gradient(135deg, rgba(135, 43, 151, 0.08) 0%, rgba(44, 90, 160, 0.08) 100%);
        border-radius: 1rem;
        border: 1px solid rgba(135, 43, 151, 0.1);
    }
    
    .page-title {
        font-size: 2rem;
        font-weight: 700;
        color: var(--gray-900);
        margin: 0;
    }
    
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1.5rem;
        margin-top: 2rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: linear-gradient(135deg, white 0%, #faf9ff 100%);
        border: 1px solid var(--gray-200);
        border-radius: 0.75rem;
        padding: 1.25rem;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
    }
    
    .stat-card:hover {
        box-shadow: var(--shadow-md);
        transform: translateY(-4px);
    }
    
    .stat-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        margin-bottom: 0.75rem;
        background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
        color: white;
    }
    
    .stat-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: var(--gray-900);
        line-height: 1;
    }
    
    .stat-label {
        color: var(--gray-500);
        font-size: 0.8125rem;
        margin-top: 0.375rem;
    }
    
    .toolbar {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 2rem;
        margin-bottom: 2rem;
        padding: 1.25rem;
        background: white;
        border: 1px solid var(--gray-200);
        border-radius: 1rem;
        box-shadow: var(--shadow-sm);
    }
    
    .resume-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .resume-card {
        background: linear-gradient(135deg, white 0%, #fafbff 100%);
        border: 1px solid var(--gray-200);
        border-radius: 0.75rem;
        padding: 1.25rem;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .resume-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        background: linear-gradient(180deg, var(--primary) 0%, var(--secondary) 100%);
    }
    
    .resume-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-4px);
    }
    
    .resume-icon {
        width: 48px;
        height: 48px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        margin-bottom: 0.75rem;
        background: linear-gradient(135deg, rgba(135, 43, 151, 0.1) 0%, rgba(44, 90, 160, 0.1) 100%);
        color: var(--primary);
    }
    
    .resume-name {
        font-weight: 600;
        font-size: 1rem;
        color: var(--gray-900);
        margin-bottom: 0.5rem;
        line-height: 1.4;
        word-break: break-word;
    }
    
    .resume-status {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.25rem 0.75rem;
        border-radius: 2rem;
        font-size: 0.75rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        color: #065f46;
    }
    
    .resume-actions {
        display: flex;
        gap: 0.5rem;
        margin-top: 1rem;
    }
    
    .resume-actions .btn {
        flex: 1;
        justify-content: center;
        font-size: 0.8125rem;
        padding: 0.5rem 0.75rem;
    }
    
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: white;
        border: 2px dashed var(--gray-300);
        border-radius: 1rem;
    }
    
    .empty-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, rgba(135, 43, 151, 0.1) 0%, rgba(44, 90, 160, 0.1) 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 40px;
        color: var(--primary);
    }
    
    .empty-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.75rem;
    }
    
    .empty-description {
        color: var(--gray-500);
        margin-bottom: 2rem;
        font-size: 1rem;
    }
    
    .modal-content {
        border: none;
        border-radius: 1rem;
        box-shadow: var(--shadow-xl);
    }
    
    .modal-header {
        border-bottom: 1px solid var(--gray-200);
        padding: 1.5rem;
    }
    
    .modal-title {
        font-weight: 700;
        color: var(--gray-900);
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .modal-footer {
        border-top: 1px solid var(--gray-200);
        padding: 1.5rem;
    }
    
    .form-label {
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
    }
    
    .form-control {
        border: 2px solid var(--gray-200);
        border-radius: 0.75rem;
        padding: 0.75rem 1rem;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(135, 43, 151, 0.1);
    }
    
    @media (max-width: 768px) {
        .page-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .toolbar {
            flex-direction: column;
        }
        
        .resume-grid {
            grid-template-columns: 1fr;
        }
        
        .sticky-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
        }
        
        .main-content {
            padding-bottom: 5rem;
        }
    }
    
    .sticky-footer {
        position: sticky;
        bottom: 0;
        z-index: 100;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-top: 1px solid var(--gray-200);
        padding: 1.25rem;
        margin: 0 -2rem -2.5rem -2rem;
        box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.1);
    }
    
    .sticky-footer .btn {
        box-shadow: 0 4px 12px rgba(135, 43, 151, 0.3);
    }
    
    /* Ensure masking works in modals */
    .modal .sensitive-data {
        filter: blur(6px) !important;
        user-select: none !important;
        cursor: not-allowed !important;
        pointer-events: none !important;
    }
    
    .modal .sensitive-data:hover {
        filter: blur(8px) !important;
    }
    
    #deleteItemName.sensitive-data {
        filter: blur(6px) !important;
        display: inline-block !important;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title" data-i18n="resumesTitle">Resume Management</h1>
</div>

<!-- TOOLBAR -->
<div class="toolbar">
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
        <i class="bi bi-cloud-upload"></i>
        <span data-i18n="addResumes">Add Resumes</span>
    </button>
    {% if resumes %}
    <button class="btn btn-outline-danger" onclick="deleteAllResumes()">
        <i class="bi bi-trash"></i>
        <span data-i18n="deleteAll">Delete All</span>
    </button>
    {% endif %}
</div>

<!-- STATS -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="bi bi-file-earmark-person"></i>
        </div>
        <div class="stat-value">{{ resumes|length }}</div>
        <div class="stat-label" data-i18n="totalResumes">Total Resumes</div>
    </div>
    <div class="stat-card">
        <div class="stat-icon">
            <i class="bi bi-check-circle"></i>
        </div>
        <div class="stat-value">{{ resumes|length }}</div>
        <div class="stat-label" data-i18n="parsed">Parsed & Ready</div>
    </div>
</div>

<!-- RESUME GRID -->
{% if resumes %}
<div class="resume-grid">
    {% for resume in resumes %}
    <div class="resume-card">
        <div class="resume-icon">
            <i class="bi bi-file-earmark-pdf-fill"></i>
        </div>
        <div class="resume-name sensitive-data">{{ resume.name }}</div>
        <span class="resume-status">
            <i class="bi bi-check-circle"></i>
            <span data-i18n="statusParsed">Parsed</span>
        </span>
        <div class="resume-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="viewResume('{{ resume.id }}')">
                <i class="bi bi-eye"></i>
                <span data-i18n="view">View</span>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteResume('{{ resume.id }}')">
                <i class="bi bi-trash"></i>
                <span data-i18n="delete">Delete</span>
            </button>
        </div>
    </div>
    {% endfor %}
</div>

<div class="sticky-footer">
    <div class="d-flex justify-content-end">
        <a href="{{ url_for('jobs_page') }}" class="btn btn-primary btn-lg">
            <span data-i18n="nextJobs">Next: Add Job Descriptions</span>
            <i class="bi bi-arrow-right"></i>
        </a>
    </div>
</div>
{% else %}
<div class="empty-state">
    <div class="empty-icon">
        <i class="bi bi-file-earmark-person"></i>
    </div>
    <h3 class="empty-title" data-i18n="noResumes">No Resumes Yet</h3>
    <p class="empty-description" data-i18n="noResumesDesc">Upload PDF resumes to get started with AI-powered candidate matching.</p>
    <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#uploadModal">
        <i class="bi bi-cloud-upload"></i>
        <span data-i18n="uploadFirst">Upload Your First Resume</span>
    </button>
</div>
{% endif %}

<!-- UPLOAD MODAL -->
<div class="modal fade" id="uploadModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" data-i18n="uploadResumes">Upload Resumes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('upload_resumes') }}" method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label" data-i18n="selectFiles">Select PDF Files:</label>
                        <input type="file" name="resumes" class="form-control" multiple accept=".pdf" required>
                        <small class="text-muted" data-i18n="pdfOnly">PDF files only (multiple allowed)</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" data-i18n="cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="upload">Upload & Parse</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- VIEW MODAL -->
<div class="modal fade" id="viewResumeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title sensitive-data" id="viewResumeTitle">Resume Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="viewResumeContent">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- DELETE CONFIRMATION MODAL -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 1rem; border: none; overflow: hidden;">
            <div class="modal-header" style="background: white; border-bottom: 1px solid var(--gray-200);">
                <h5 class="modal-title" style="display: flex; align-items: center; gap: 0.5rem; font-weight: 700;">
                    <i class="bi bi-exclamation-circle" style="color: var(--gray-600); font-size: 1.5rem;"></i>
                    <span data-i18n="confirmDelete">Confirm Delete</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <p style="font-size: 1.125rem; margin-bottom: 1rem; color: var(--gray-700);" data-i18n="deleteQuestion">Are you sure you want to delete this resume?</p>
                <div style="background: linear-gradient(135deg, rgba(135, 43, 151, 0.05) 0%, rgba(44, 90, 160, 0.05) 100%); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border-left: 4px solid var(--primary);">
                    <p class="fw-bold mb-0 sensitive-data" id="deleteItemName" style="color: var(--gray-900);"></p>
                </div>
                <p class="mb-0" style="display: flex; align-items: center; gap: 0.5rem; color: var(--gray-600);">
                    <i class="bi bi-info-circle"></i>
                    <span data-i18n="cannotUndo">This action cannot be undone.</span>
                </p>
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--gray-200); padding: 1.5rem;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>
                    <span data-i18n="cancelBtn">Cancel</span>
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                    <i class="bi bi-trash-fill"></i>
                    <span data-i18n="deleteBtn">Delete Permanently</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- DELETE ALL CONFIRMATION MODAL -->
<div class="modal fade" id="deleteAllModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: 1rem; border: none; overflow: hidden;">
            <div class="modal-header" style="background: white; border-bottom: 1px solid var(--gray-200);">
                <h5 class="modal-title" style="display: flex; align-items: center; gap: 0.5rem; font-weight: 700;">
                    <i class="bi bi-exclamation-circle" style="color: var(--gray-600); font-size: 1.5rem;"></i>
                    <span data-i18n="confirmDeleteAll">Delete All Resumes?</span>
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="padding: 2rem;">
                <p style="font-size: 1.125rem; margin-bottom: 1rem; color: var(--gray-700);" data-i18n="deleteAllQuestion">Are you sure you want to delete ALL resumes?</p>
                <div style="background: var(--gray-50); padding: 1rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid var(--gray-200);">
                    <p class="fw-bold mb-2" style="font-size: 1rem; color: var(--gray-900);"><i class="bi bi-info-circle"></i> <span data-i18n="warning">Warning</span></p>
                    <ul class="mb-0" style="padding-left: 1.5rem; color: var(--gray-700);">
                        <li data-i18n="allResumesDeleted">All uploaded resumes will be permanently deleted</li>
                        <li data-i18n="dataLost">All parsed data will be lost</li>
                        <li data-i18n="cannotRecover">This cannot be undone or recovered</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer" style="border-top: 1px solid var(--gray-200); padding: 1.5rem;">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="bi bi-x-circle"></i>
                    <span data-i18n="cancelBtn">Cancel</span>
                </button>
                <button type="button" class="btn btn-danger" id="confirmDeleteAllBtn">
                    <i class="bi bi-trash-fill"></i>
                    <span data-i18n="deleteAllBtn">Delete All Permanently</span>
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// ========================================
// TRANSLATION DICTIONARY FOR RESUME DATA
// ========================================
const dataTranslations = {
    // Field name translations (for displaying labels)
    labels: {
        en: {
            summary: 'Summary',
            skills: 'Skills',
            experience: 'Experience',
            education: 'Education',
            noData: 'No detailed information available for this resume.'
        },
        ar: {
            summary: 'Ø§Ù„Ù…Ù„Ø®Øµ',
            skills: 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª',
            experience: 'Ø§Ù„Ø®Ø¨Ø±Ø©',
            education: 'Ø§Ù„ØªØ¹Ù„ÙŠÙ…',
            noData: 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØªÙØµÙŠÙ„ÙŠØ© Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©.'
        }
    },
    
    // Common skills translations
    skills: {
        // Technical skills
        'Python': 'Ø¨Ø§ÙŠØ«ÙˆÙ†',
        'Java': 'Ø¬Ø§ÙØ§',
        'JavaScript': 'Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª',
        'C++': 'Ø³ÙŠ++',
        'C#': 'Ø³ÙŠ Ø´Ø§Ø±Ø¨',
        'Flutter': 'ÙÙ„Ø§ØªØ±',
        'Dart': 'Ø¯Ø§Ø±Øª',
        'React': 'Ø±ÙŠØ§ÙƒØª',
        'Angular': 'Ø£Ù†Ø¬ÙˆÙ„Ø§Ø±',
        'Vue': 'ÙÙŠÙˆ',
        'Node.js': 'Ù†ÙˆØ¯ Ø¬ÙŠ Ø¥Ø³',
        'Django': 'Ø¬Ø§Ù†ØºÙˆ',
        'Flask': 'ÙÙ„Ø§Ø³Ùƒ',
        'Spring': 'Ø³Ø¨Ø±ÙŠÙ†Øº',
        'ASP.NET': 'Ø¥ÙŠÙ‡ Ø¥Ø³ Ø¨ÙŠ Ø¯ÙˆØª Ù†Øª',
        'Firebase': 'ÙØ§ÙŠØ±Ø¨ÙŠØ³',
        'MongoDB': 'Ù…ÙˆÙ†ØºÙˆ Ø¯ÙŠ Ø¨ÙŠ',
        'MySQL': 'Ù…Ø§ÙŠ Ø¥Ø³ ÙƒÙŠÙˆ Ø¥Ù„',
        'PostgreSQL': 'Ø¨ÙˆØ³ØªØ¬Ø±Ø³ ÙƒÙŠÙˆ Ø¥Ù„',
        'Git': 'Ø¬ÙŠØª',
        'Docker': 'Ø¯ÙˆÙƒØ±',
        'Kubernetes': 'ÙƒÙˆØ¨Ø±Ù†ØªØ³',
        'AWS': 'Ø¥ÙŠÙ‡ Ø¯Ø¨Ù„ÙŠÙˆ Ø¥Ø³',
        'Azure': 'Ø£Ø²ÙˆØ±',
        'Google Cloud': 'Ø¬ÙˆØ¬Ù„ ÙƒÙ„Ø§ÙˆØ¯',
        
        // Soft skills
        'Team player': 'Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ',
        'Problem solving': 'Ø­Ù„ Ø§Ù„Ù…Ø´ÙƒÙ„Ø§Øª',
        'Communication': 'Ø§Ù„ØªÙˆØ§ØµÙ„',
        'Leadership': 'Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©',
        'Analytical skills': 'Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªØ­Ù„ÙŠÙ„ÙŠØ©',
        'Time management': 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙ‚Øª',
        'Creativity': 'Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹',
        'Adaptability': 'Ø§Ù„Ù‚Ø¯Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙƒÙŠÙ'
    }
};

// ========================================
// TRANSLATE SKILL NAME
// ========================================
function translateSkill(skill, toLang) {
    if (toLang === 'en') {
        // Find Arabic key that maps to this English value
        for (let [en, ar] of Object.entries(dataTranslations.skills)) {
            if (ar === skill) return en;
        }
        return skill; // Return as-is if no translation
    } else {
        // Translate English to Arabic
        return dataTranslations.skills[skill] || skill;
    }
}

// ========================================
// DELETE RESUME
// ========================================
function deleteResume(id) {
    const resumeCard = event.target.closest('.resume-card');
    const resumeName = resumeCard.querySelector('.resume-name').textContent;
    
    document.getElementById('deleteItemName').textContent = resumeName;
    
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
    
    document.getElementById('confirmDeleteBtn').onclick = function() {
        fetch(`/api/resumes/delete/${id}`, { method: 'DELETE' })
            .then(r => r.json())
            .then(d => { 
                if (d.success) {
                    modal.hide();
                    location.reload();
                }
            })
            .catch(e => {
                alert('Error: ' + e);
                modal.hide();
            });
    };
}

// ========================================
// DELETE ALL RESUMES
// ========================================
function deleteAllResumes() {
    const modal = new bootstrap.Modal(document.getElementById('deleteAllModal'));
    modal.show();
    
    document.getElementById('confirmDeleteAllBtn').onclick = function() {
        fetch('/api/resumes/delete-all', { method: 'DELETE' })
            .then(r => r.json())
            .then(d => { 
                if (d.success) {
                    modal.hide();
                    location.reload();
                }
            })
            .catch(e => {
                alert('Error: ' + e);
                modal.hide();
            });
    };
}

// ========================================
// VIEW RESUME - WITH LIVE TRANSLATION
// ========================================
function viewResume(id) {
    const modal = new bootstrap.Modal(document.getElementById('viewResumeModal'));
    modal.show();
    
    // Get current language
    const lang = localStorage.getItem('preferredLanguage') || 'en';
    
    const loadingMsg = lang === 'ar' ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...' : 'Loading resume...';
    
    document.getElementById('viewResumeContent').innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary"></div>
            <p class="mt-3 text-muted">${loadingMsg}</p>
        </div>
    `;
    
    console.log('ğŸ” Fetching resume with ID:', id);
    
    fetch(`/api/resumes/view/${id}`)
        .then(r => {
            if (!r.ok) throw new Error(`HTTP error! status: ${r.status}`);
            return r.json();
        })
        .then(data => {
            console.log('âœ… Resume data received:', data);
            
            // Set modal title
            document.getElementById('viewResumeTitle').textContent = 
                lang === 'ar' ? 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©' : 'Resume Details';
            
            // Get label translations
            const t = dataTranslations.labels[lang];
            
            let html = `<div class="resume-details" style="direction: ${lang === 'ar' ? 'rtl' : 'ltr'};">`;
            
            // Personal Info
            if (data.name) {
                html += `<h5><i class="bi bi-person me-2"></i><span class="sensitive-data">${data.name}</span></h5>`;
            }
            
            if (data.email || data.phone) {
                html += '<div class="mb-3">';
                if (data.email) html += `<p><i class="bi bi-envelope me-2"></i><span class="sensitive-data">${data.email}</span></p>`;
                if (data.phone) html += `<p><i class="bi bi-telephone me-2"></i><span class="sensitive-data">${data.phone}</span></p>`;
                html += '</div>';
            }
            
            // Summary
            if (data.summary) {
                html += `
                    <div class="mb-3">
                        <h6 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            <i class="bi bi-card-text me-2"></i>${t.summary}
                        </h6>
                        <p style="line-height: 1.6;">${data.summary}</p>
                    </div>`;
            }
            
            // Skills - with translation
            if (data.skills && data.skills.length > 0) {
                html += `
                    <div class="mb-3">
                        <h6 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            <i class="bi bi-stack me-2"></i>${t.skills}
                        </h6>
                        <div class="d-flex flex-wrap gap-2">`;
                
                // Translate skills if switching to Arabic
                data.skills.forEach(skill => {
                    const translatedSkill = translateSkill(skill, lang);
                    html += `<span class="badge" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); padding: 0.5rem 1rem; font-size: 0.875rem;">${translatedSkill}</span>`;
                });
                
                html += '</div></div>';
            }
            
            // Experience
            if (data.experience) {
                html += `
                    <div class="mb-3">
                        <h6 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            <i class="bi bi-briefcase me-2"></i>${t.experience}
                        </h6>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${data.experience}</p>
                    </div>`;
            }
            
            // Education
            if (data.education) {
                html += `
                    <div class="mb-3">
                        <h6 style="color: var(--primary); font-weight: 600; margin-bottom: 0.5rem;">
                            <i class="bi bi-mortarboard me-2"></i>${t.education}
                        </h6>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${data.education}</p>
                    </div>`;
            }
            
            // If no data
            const hasData = data.name || data.email || data.phone || data.summary || 
                           data.skills || data.experience || data.education;
            
            if (!hasData) {
                html += `<div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>${t.noData}
                </div>`;
            }
            
            html += '</div>';
            document.getElementById('viewResumeContent').innerHTML = html;
        })
        .catch(error => {
            console.error('âŒ Error loading resume:', error);
            
            const errorMsg = lang === 'ar' ? 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©' : 'Error Loading Resume';
            const errorDetail = lang === 'ar' 
                ? 'ØºÙŠØ± Ù‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©.' 
                : 'Unable to load resume details.';
            
            document.getElementById('viewResumeContent').innerHTML = `
                <div class="alert alert-danger">
                    <h6><i class="bi bi-exclamation-triangle me-2"></i>${errorMsg}</h6>
                    <p class="mb-2">${errorDetail}</p>
                    <small class="text-muted">Error: ${error.message}</small>
                </div>
            `;
        });
}

// ========================================
// TRANSLATIONS
// ========================================
const pageTranslations = {
    en: {
        resumesTitle: "Resume Management",
        totalResumes: "Total Resumes",
        parsed: "Parsed & Ready",
        addResumes: "Add Resumes",
        deleteAll: "Delete All",
        statusParsed: "Parsed",
        view: "View",
        delete: "Delete",
        nextJobs: "Next: Add Job Descriptions",
        noResumes: "No Resumes Yet",
        noResumesDesc: "Upload PDF resumes to get started with AI-powered candidate matching.",
        uploadFirst: "Upload Your First Resume",
        uploadResumes: "Upload Resumes",
        selectFiles: "Select PDF Files:",
        pdfOnly: "PDF files only (multiple allowed)",
        cancel: "Cancel",
        upload: "Upload & Parse",
        confirmDelete: "Confirm Delete",
        deleteQuestion: "Are you sure you want to delete this resume?",
        cannotUndo: "This action cannot be undone.",
        cancelBtn: "Cancel",
        deleteBtn: "Delete Permanently",
        confirmDeleteAll: "Delete All Resumes?",
        deleteAllQuestion: "Are you sure you want to delete ALL resumes?",
        warning: "Warning!",
        allResumesDeleted: "All uploaded resumes will be permanently deleted",
        dataLost: "All parsed data will be lost",
        cannotRecover: "This cannot be undone or recovered",
        deleteAllBtn: "Delete All Permanently"
    },
    ar: {
        resumesTitle: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ©",
        totalResumes: "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³ÙŠØ±",
        parsed: "Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©",
        addResumes: "Ø¥Ø¶Ø§ÙØ© Ø³ÙŠØ± Ø°Ø§ØªÙŠØ©",
        deleteAll: "Ø­Ø°Ù Ø§Ù„ÙƒÙ„",
        statusParsed: "ØªÙ… Ø§Ù„ØªØ­Ù„ÙŠÙ„",
        view: "Ø¹Ø±Ø¶",
        delete: "Ø­Ø°Ù",
        nextJobs: "Ø§Ù„ØªØ§Ù„ÙŠ: Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆØ¸Ø§Ø¦Ù",
        noResumes: "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ± Ø°Ø§ØªÙŠØ©",
        noResumesDesc: "Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ© Ø¨ØµÙŠØºØ© PDF Ù„Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø© Ø§Ù„Ø°ÙƒÙŠØ©.",
        uploadFirst: "ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©",
        uploadResumes: "ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ©",
        selectFiles: "Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª PDF:",
        pdfOnly: "Ù…Ù„ÙØ§Øª PDF ÙÙ‚Ø· (ÙŠÙ…ÙƒÙ† ØªØ­Ù…ÙŠÙ„ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª)",
        cancel: "Ø¥Ù„ØºØ§Ø¡",
        upload: "ØªØ­Ù…ÙŠÙ„ ÙˆÙ…Ø¹Ø§Ù„Ø¬Ø©",
        confirmDelete: "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù",
        deleteQuestion: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ",
        cannotUndo: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.",
        cancelBtn: "Ø¥Ù„ØºØ§Ø¡",
        deleteBtn: "Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹",
        confirmDeleteAll: "Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ",
        deleteAllQuestion: "Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ©ØŸ",
        warning: "ØªØ­Ø°ÙŠØ±!",
        allResumesDeleted: "Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø³ÙŠØ± Ø§Ù„Ø°Ø§ØªÙŠØ© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹",
        dataLost: "Ø³ÙŠØªÙ… ÙÙ‚Ø¯Ø§Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„Ù„Ø©",
        cannotRecover: "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹",
        deleteAllBtn: "Ø­Ø°Ù Ø§Ù„ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹"
    }
};

Object.assign(translations.en, pageTranslations.en);
Object.assign(translations.ar, pageTranslations.ar);
</script>
{% endblock %}